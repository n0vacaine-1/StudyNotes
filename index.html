<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Notes + Cookie Consent</title>
  <style>
    :root {
      --brand: #3949ab;
      --bg: #ffffff;
      --muted: #f6f7fb;
      --text: #222;
      --sub: #666;
      --danger: #c62828;
      --ok: #2e7d32;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
    }
    header.appbar {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--brand);
      color: #fff;
    }
    header .title { font-weight: 700; }
    header .actions button {
      background: transparent;
      border: 1px solid rgba(255,255,255,.7);
      color: #fff;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
    }
    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }
    .search {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .search input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      flex: 1;
      font-size: 16px;
    }
    .notes {
      background: var(--muted);
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 8px;
    }
    .note {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }
    .note h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
    }
    .note p {
      margin: 0;
      color: var(--sub);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .note .meta { color: #999; font-size: 12px; margin-top: 6px; }
    .note .actions {
      display: flex;
      align-items: start;
      gap: 6px;
    }
    .btn {
      border: 1px solid #ddd;
      background: #fff;
      color: var(--text);
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn.primary { background: var(--brand); color: #fff; border-color: var(--brand); }
    .btn.danger { background: var(--danger); color: #fff; border-color: var(--danger); }
    .fab {
      position: fixed;
      right: 20px;
      bottom: 20px;
      display: flex;
      gap: 8px;
      z-index: 5;
    }
    .fab .btn { box-shadow: 0 4px 14px rgba(0,0,0,.12); }

    /* Modal + Drawer */
    .modal-backdrop, .drawer-backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal, .drawer {
      background: #fff;
      border-radius: 12px;
      max-width: 720px;
      width: calc(100% - 24px);
      border: 1px solid #eee;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .modal header, .drawer header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; border-bottom: 1px solid #eee;
    }
    .modal .content, .drawer .content {
      padding: 16px;
      max-height: 70vh; overflow: auto;
    }
    .modal .actions, .drawer .actions {
      display: flex; gap: 8px; justify-content: end;
      padding: 12px 16px; border-top: 1px solid #eee;
    }

    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
    .field input, .field textarea {
      border: 1px solid #ddd; border-radius: 8px; padding: 10px 12px; font-size: 14px;
    }
    .field textarea { min-height: 160px; }

    /* Cookie banner */
    .cookie-banner {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: #fff;
      border-top: 1px solid #eee;
      box-shadow: 0 -6px 18px rgba(0,0,0,.08);
      padding: 12px 16px;
      display: none;
      z-index: 100;
    }
    .cookie-banner .row {
      max-width: 1100px; margin: 0 auto;
      display: flex; gap: 12px; flex-wrap: wrap; align-items: center; justify-content: space-between;
    }
    .cookie-banner .msg { flex: 1; min-width: 240px; }
    .cookie-banner .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .link { color: var(--brand); text-decoration: underline; cursor: pointer; }
    .pill {
      display: inline-block; padding: 2px 8px; border-radius: 999px;
      border: 1px solid #ddd; font-size: 12px; color: #555;
    }
    .switch {
      position: relative; display: inline-block; width: 46px; height: 26px;
    }
    .switch input { display:none; }
    .slider {
      position: absolute; cursor: pointer; inset: 0; background: #ccc; transition: .2s; border-radius: 26px;
    }
    .slider:before {
      position: absolute; content: ""; height: 20px; width: 20px; left: 3px; top: 3px;
      background: white; transition: .2s; border-radius: 50%;
    }
    input:checked + .slider { background: var(--brand); }
    input:checked + .slider:before { transform: translateX(20px); }
    .locked { opacity: .6; }
    .hint { color: #777; font-size: 13px; }
  </style>
</head>
<body>
  <header class="appbar">
    <div class="title">Study Notes</div>
    <div class="actions">
      <button id="btnCookieSettings" title="Cookie Settings">Cookie Settings</button>
    </div>
  </header>

  <main>
    <div class="search">
      <input id="searchInput" placeholder="Search notes..." />
      <button id="btnAdd" class="btn primary">Add Note</button>
    </div>
    <div id="notesList" class="notes"></div>
  </main>

  <div class="fab">
    <button id="btnExport" class="btn">Export</button>
    <button id="btnImport" class="btn">Import</button>
  </div>

  <!-- Note Editor Modal -->
  <div id="noteModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <header>
        <div id="modalTitle">Edit Note</div>
        <button id="closeModal" class="btn">Close</button>
      </header>
      <div class="content">
        <div class="field">
          <label>Title</label>
          <input id="noteTitle" />
        </div>
        <div class="field">
          <label>Content</label>
          <textarea id="noteContent"></textarea>
        </div>
      </div>
      <div class="actions">
        <button id="deleteNote" class="btn danger">Delete</button>
        <button id="saveNote" class="btn primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Terms & Policies Modal -->
  <div id="termsBackdrop" class="modal-backdrop">
    <div class="modal">
      <header>
        <div>Terms & Policies</div>
        <button id="closeTerms" class="btn">Close</button>
      </header>
      <div class="content">
        <p><strong>Terms of Service (example)</strong></p>
        <p>By using this site, you agree to our Terms and Consent Policy. Essential cookies are required to provide requested features. Analytics and marketing cookies are optional and disabled unless you opt in.</p>
        <p><strong>Privacy & Cookie Policy (example)</strong></p>
        <p>Notes are stored in a browser cookie on this device. You can delete them using the appâ€™s controls or via your browser settings.</p>
        <p class="hint">Replace this text with links to your real Terms and Privacy/Cookie Policy.</p>
      </div>
      <div class="actions">
        <button id="okTerms" class="btn primary">OK</button>
      </div>
    </div>
  </div>

  <!-- Cookie Settings Drawer -->
  <div id="settingsBackdrop" class="drawer-backdrop">
    <div class="drawer" style="width: 680px; max-width: calc(100% - 24px);">
      <header>
        <div>Cookie Settings</div>
        <button id="closeSettings" class="btn">Close</button>
      </header>
      <div class="content">
        <div class="note" style="align-items:center;">
          <div>
            <div><strong>Essential</strong> <span class="pill">Always On</span></div>
            <div class="hint">Required for core functionality (storing notes and consent). Not used for tracking.</div>
          </div>
          <div class="locked">
            <label class="switch">
              <input type="checkbox" checked disabled />
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="note" style="align-items:center;">
          <div>
            <div><strong>Analytics</strong></div>
            <div class="hint">Helps understand usage to improve the app (disabled unless you opt in).</div>
          </div>
          <div>
            <label class="switch">
              <input id="toggleAnalytics" type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="note" style="align-items:center;">
          <div>
            <div><strong>Marketing</strong></div>
            <div class="hint">Used to personalize content or offers (disabled unless you opt in).</div>
          </div>
          <div>
            <label class="switch">
              <input id="toggleMarketing" type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button id="rejectAll" class="btn">Reject All</button>
        <button id="savePrefs" class="btn primary">Save Preferences</button>
      </div>
    </div>
  </div>

  <!-- Cookie Banner -->
  <div id="cookieBanner" class="cookie-banner">
    <div class="row">
      <div class="msg">
        We use cookies to run essential features and, with permission, analytics and marketing. 
        See our <span id="openTermsLink" class="link">Terms & Policy</span>.
      </div>
      <div class="actions">
        <button id="openSettings" class="btn">Settings</button>
        <button id="rejectBanner" class="btn">Reject All</button>
        <button id="acceptBanner" class="btn primary">Accept All</button>
      </div>
    </div>
  </div>

  <script>
    // --------------- Utilities: cookies ---------------
    function setCookie(name, value, maxAgeSeconds) {
      const enc = encodeURIComponent(value);
      document.cookie = name + '=' + enc + '; max-age=' + maxAgeSeconds + '; path=/; SameSite=Lax';
    }
    function getCookie(name) {
      const parts = (document.cookie || '').split(';');
      for (const p of parts) {
        const [k, ...rest] = p.split('=');
        if (!k) continue;
        if (k.trim() === name) return rest.join('=').trim();
      }
      return null;
    }
    function readCookieJSON(name, fallback) {
      const raw = getCookie(name);
      if (!raw) return fallback;
      try { return JSON.parse(decodeURIComponent(raw)); } catch { return fallback; }
    }

    // --------------- Consent manager ---------------
    const CONSENT_COOKIE = 'consent_prefs';
    const CONSENT_MAX_AGE = 60 * 60 * 24 * 180;
    const defaultConsent = { essential: true, analytics: false, marketing: false };

    function getConsent() {
      return readCookieJSON(CONSENT_COOKIE, null) || defaultConsent;
    }
    function saveConsent(obj) {
      setCookie(CONSENT_COOKIE, JSON.stringify(obj), CONSENT_MAX_AGE);
    }
    function hasRecordedConsent() {
      return getCookie(CONSENT_COOKIE) != null;
    }

    // --------------- Notes store (cookie) ---------------
    const NOTES_COOKIE = 'notes';
    const NOTES_MAX_AGE = 60 * 60 * 24 * 180;

    function loadNotes() {
      const list = readCookieJSON(NOTES_COOKIE, []);
      return Array.isArray(list) ? list : [];
    }
    function saveNotes(list) {
      setCookie(NOTES_COOKIE, JSON.stringify(list), NOTES_MAX_AGE);
    }

    // --------------- State ---------------
    let notes = [];
    let query = '';
    let editingId = null;

    // --------------- DOM refs ---------------
    const notesList = document.getElementById('notesList');
    const searchInput = document.getElementById('searchInput');
    const btnAdd = document.getElementById('btnAdd');
    const btnExport = document.getElementById('btnExport');
    const btnImport = document.getElementById('btnImport');

    const noteModalBackdrop = document.getElementById('noteModalBackdrop');
    const noteTitle = document.getElementById('noteTitle');
    const noteContent = document.getElementById('noteContent');
    const modalTitle = document.getElementById('modalTitle');
    const closeModal = document.getElementById('closeModal');
    const saveNoteBtn = document.getElementById('saveNote');
    const deleteNoteBtn = document.getElementById('deleteNote');

    const cookieBanner = document.getElementById('cookieBanner');
    const openSettingsBtn = document.getElementById('openSettings');
    const acceptBannerBtn = document.getElementById('acceptBanner');
    const rejectBannerBtn = document.getElementById('rejectBanner');
    const openTermsLink = document.getElementById('openTermsLink');

    const settingsBackdrop = document.getElementById('settingsBackdrop');
    const toggleAnalytics = document.getElementById('toggleAnalytics');
    const toggleMarketing = document.getElementById('toggleMarketing');
    const savePrefsBtn = document.getElementById('savePrefs');
    const rejectAllBtn = document.getElementById('rejectAll');
    const closeSettings = document.getElementById('closeSettings');

    const btnCookieSettings = document.getElementById('btnCookieSettings');
    const termsBackdrop = document.getElementById('termsBackdrop');
    const closeTerms = document.getElementById('closeTerms');
    const okTerms = document.getElementById('okTerms');

    // --------------- Render notes ---------------
    function render() {
      const q = (query || '').trim().toLowerCase();
      const filtered = notes.filter(n => {
        if (!q) return true;
        return (n.t || '').toLowerCase().includes(q) || (n.c || '').toLowerCase().includes(q);
      });
      notesList.innerHTML = '';
      if (filtered.length === 0) {
        const div = document.createElement('div');
        div.style.padding = '24px';
        div.style.textAlign = 'center';
        div.textContent = 'No notes yet. Click "Add Note".';
        notesList.appendChild(div);
        return;
      }
      for (const n of filtered) {
        const item = document.createElement('div');
        item.className = 'note';
        const left = document.createElement('div');
        const h3 = document.createElement('h3');
        h3.textContent = n.t && n.t.trim() ? n.t : '(Untitled)';
        const p = document.createElement('p');
        p.textContent = n.c || 'No content';
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = 'Updated: ' + new Date(n.u || Date.now()).toLocaleString();
        left.appendChild(h3); left.appendChild(p); left.appendChild(meta);

        const right = document.createElement('div');
        right.className = 'actions';
        const editBtn = document.createElement('button');
        editBtn.className = 'btn';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => openEditor(n.id);
        const delBtn = document.createElement('button');
        delBtn.className = 'btn danger';
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => removeNote(n.id);
        right.appendChild(editBtn); right.appendChild(delBtn);

        item.appendChild(left); item.appendChild(right);
        notesList.appendChild(item);
      }
    }

    // --------------- Notes actions ---------------
    function openEditor(id) {
      const isNew = !id;
      editingId = id || ('n_' + Date.now());
      const n = isNew ? { id: editingId, t: '', c: '', u: Date.now() }
                      : notes.find(x => x.id === id);
      noteTitle.value = n ? (n.t || '') : '';
      noteContent.value = n ? (n.c || '') : '';
      modalTitle.textContent = isNew ? 'New Note' : 'Edit Note';
      deleteNoteBtn.style.display = isNew ? 'none' : 'inline-block';
      noteModalBackdrop.style.display = 'flex';
    }
    function closeEditor() {
      noteModalBackdrop.style.display = 'none';
      editingId = null;
    }
    function saveEditor() {
      const t = noteTitle.value.trim();
      const c = noteContent.value.trim();
      const now = Date.now();
      const idx = notes.findIndex(x => x.id === editingId);
      if (idx >= 0) {
        notes[idx] = { ...notes[idx], t, c, u: now };
      } else {
        notes.unshift({ id: editingId, t, c, u: now });
      }
      saveNotes(notes);
      closeEditor();
      render();
    }
    function removeNote(id) {
      if (!confirm('Delete this note?')) return;
      notes = notes.filter(x => x.id !== id);
      saveNotes(notes);
      render();
    }

    // --------------- Export / Import ---------------
    btnExport.addEventListener('click', () => {
      const data = JSON.stringify(notes, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'notes-export.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });
    btnImport.addEventListener('click', async () => {
      const input = document.createElement('input');
      input.type = 'file'; input.accept = '.json,application/json';
      input.onchange = async () => {
        const file = input.files && input.files[0];
        if (!file) return;
        const text = await file.text();
        try {
          const arr = JSON.parse(text);
          if (!Array.isArray(arr)) throw new Error('Invalid file');
          // keep compact shape {id,t,c,u}
          notes = arr.map(e => ({
            id: String(e.id || 'n_' + Math.random()),
            t: String(e.t || e.title || ''),
            c: String(e.c || e.content || ''),
            u: Number(e.u || Date.now()),
          }));
          saveNotes(notes);
          render();
        } catch (e) {
          alert('Import failed: ' + e.message);
        }
      };
      input.click();
    });

    // --------------- Search + Add ---------------
    searchInput.addEventListener('input', (e) => {
      query = e.target.value || '';
      render();
    });
    btnAdd.addEventListener('click', () => openEditor(null));
    closeModal.addEventListener('click', closeEditor);
    saveNoteBtn.addEventListener('click', saveEditor);
    deleteNoteBtn.addEventListener('click', () => {
      if (!editingId) return;
      removeNote(editingId);
      closeEditor();
    });

    // --------------- Cookie banner + settings ---------------
    function showBanner() { cookieBanner.style.display = 'block'; }
    function hideBanner() { cookieBanner.style.display = 'none'; }

    openSettingsBtn.addEventListener('click', () => {
      cookieBanner.style.display = 'none';
      openSettings();
    });
    acceptBannerBtn.addEventListener('click', () => {
      saveConsent({ essential: true, analytics: true, marketing: true });
      hideBanner();
      maybeStartNonEssential();
    });
    rejectBannerBtn.addEventListener('click', () => {
      saveConsent({ essential: true, analytics: false, marketing: false });
      hideBanner();
    });
    openTermsLink.addEventListener('click', () => openTerms());

    // Settings drawer
    function openSettings() {
      const c = getConsent();
      toggleAnalytics.checked = !!c.analytics;
      toggleMarketing.checked = !!c.marketing;
      settingsBackdrop.style.display = 'flex';
    }
    function closeSettingsDrawer() {
      settingsBackdrop.style.display = 'none';
    }
    savePrefsBtn.addEventListener('click', () => {
      saveConsent({
        essential: true,
        analytics: !!toggleAnalytics.checked,
        marketing: !!toggleMarketing.checked
      });
      closeSettingsDrawer();
      maybeStartNonEssential();
    });
    rejectAllBtn.addEventListener('click', () => {
      saveConsent({ essential: true, analytics: false, marketing: false });
      closeSettingsDrawer();
    });
    closeSettings.addEventListener('click', closeSettingsDrawer);
    btnCookieSettings.addEventListener('click', openSettings);

    // Terms modal
    function openTerms() { termsBackdrop.style.display = 'flex'; }
    function closeTermsModal() { termsBackdrop.style.display = 'none'; }
    closeTerms.addEventListener('click', closeTermsModal);
    okTerms.addEventListener('click', closeTermsModal);

    // --------------- Non-essential feature gating ---------------
    function maybeStartNonEssential() {
      const c = getConsent();
      // Example placeholders: plug in real analytics/ads only if opted in.
      if (c.analytics) {
        // initializeAnalytics();
        console.log('Analytics enabled by consent');
      }
      if (c.marketing) {
        // initializeMarketing();
        console.log('Marketing enabled by consent');
      }
    }

    // --------------- Init ---------------
    function init() {
      notes = loadNotes();
      render();

      if (!hasRecordedConsent()) {
        showBanner();
      } else {
        hideBanner();
        maybeStartNonEssential();
      }
    }
    init();
      ...
  <!-- page content -->

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- One Tap / Button -->
  <div id="g_id_onload"
       data-client_id="YOUR_CLIENT_ID"
       data-login_uri="https://YOUR_LOGIN_ENDPOINT/auth/google"
       data-auto_prompt="true">
  </div>
  <div class="g_id_signin" data-type="standard" data-size="large"></div>
</body>
</html>
